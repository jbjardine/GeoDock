# Installation — Mode proxyCe guide déploie uniquement le proxy Nginx qui relaie 100 % des requêtes vers l’API officielle. Utile pour valider l’installation et le réseau.Prérequis: Linux x86_64, Docker Engine + Compose v2## Avertissement- Droits Docker: exécuter Docker sans `sudo` nécessite que l’utilisateur appartienne au groupe `docker`.  - Ajouter: `sudo usermod -aG docker <user>` puis se reconnecter (ou `newgrp docker`).  - Sinon, précéder les commandes de `sudo`.- Mode par défaut: TLS bridge (HTTP accepté, proxy → amont en HTTPS).  - Redirection HTTP→HTTPS: par défaut désactivée (`REDIRECT_HTTP_TO_HTTPS=false`).  - Pour une politique 100 % HTTPS, définir `REDIRECT_HTTP_TO_HTTPS=true` et, si souhaité, `EXPOSE_HEALTH_ON_HTTP=false` pour rediriger aussi `/_health`.## 1) Diagnostic rapide```bashbash scripts/doctor.sh```## 2) Démarrer le proxy```bashbash scripts/proxy_up.sh```Le script crée `.env` si absent, force `MODE=remote` et `SERVER_NAME=$(hostname -f)`, puis construit et démarre le service `proxy`.## 3) Vérifier```bashbash scripts/proxy_verify.sh```Attendu: `{ "status": "ok", "mode": "remote" }`.## 4) Supervision (optionnel)- UI Portainer + Dozzle (facultatif):  - `bash scripts/tools_up.sh`  - Portainer: `https://<host>:9443`, Dozzle: `http://<host>:9999`- Docker context (CLI/Docker Desktop):  - `docker context create srv --docker "host=ssh://user@host"`  - `docker context use srv && docker ps`## 5) Arrêt / nettoyage```bashbash scripts/stack_stop.sh --down```Notes:- Ports 80/443 exposés; un certificat auto‑signé est généré si aucun certificat n’est monté.- Éditeurs Windows: éviter les fins de ligne CRLF dans `.env`. Si besoin, corriger: `sed -i 's/\r$//' .env`.  - La substitution de variables Nginx est strictement limitée via `NGINX_ENVSUBST_FILTER` pour ne pas altérer les variables Nginx (`$host`, `$request_uri`, etc.).## 6) Parité vs service officiel (optionnel)Un script est fourni pour vérifier rapidement la forme des réponses entre votre proxy et l’API officielle.```bashBASE=http://localhost \REMOTE_BASE=https://api-adresse.data.gouv.fr \python3 scripts/parity_check.py```